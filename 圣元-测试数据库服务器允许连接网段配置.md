---
title: 服务器允许连接网段配置
date: 2025-04-21 05:21:06
tags:
  - 服务器
  - iproute
keywords: iproute
categories: 实操
---



## 测试数据库服务器允许连接网段配置

**涉及修改静态路由表，请确保操作无误**
**涉及修改静态路由表，请确保操作无误**
**涉及修改静态路由表，请确保操作无误**



### 一、操作步骤

   **操作是基于 保持双路由 的方式进行的，且不持久化，如有需要自行调整**

1. **预处理（配置备份）**
```bash
# 备份当前路由表
ip route show > /backup/route-conf/backup_$(date +%Y%m%d).conf
```

2. **渐进式路由调整**

   **按需修改掩码配置**
```bash
# 添加新路由（/27掩码覆盖228-255）
ip route add 10.8.15.224/27 via 172.16.28.13 dev eth1 metric 100

# 保留原240/28路由（metric值更高）
ip route change 10.8.15.240/28 via 172.16.28.13 dev eth1 metric 200
```

3. **验证阶段**
```bash
# 查看生效路由
ip route get 10.8.15.228  # 应显示走eth1
ip route get 10.8.15.240  # 应显示走eth1但metric更高

# 连接性测试（从228-255网段测试Oracle连接）
tnsping <oracle_service> -source_address 10.8.15.230
```

4. **正式切换（保持双路由24小时）**
```bash
# 确认新路由稳定后删除旧路由
ip route del 10.8.15.240/28 via 172.16.28.13 dev eth1
```

5. **回滚方案**
```bash
# 紧急回滚命令（恢复原路由）
ip route flush 10.8.15.224/27
ip route replace 10.8.15.240/28 via 172.16.28.13 dev eth1 metric 100
```

**操作检查清单**：

1. [ ] 确认备份文件存在且可读
2. [ ] 新旧路由metric值设置正确（新路由metric更低）



### 二、原理

* 基于静态路由表实现的，具体可参考下列文章 ip route 部分

  [linux: ip route 与 route 用法详解与对比](https://blog.csdn.net/qq_36803941/article/details/135044459)