---
title: XHProf介绍
date: 2023-03-25 13:21:42
tags:
  - PHP
  - Xhprof
keywords: Xhprof
categories: 实操
---





## 工具

- XHProf

  - 以url（一次请求）为最小单位分析函数调用栈

    ![image-20221121183536768](https://lalalademaxiya01.oss-cn-beijing.aliyuncs.com/img/202212090855763.png)

  - 安装：

    - 最低限度：php安装扩展，配置配置项，index.php中注入监控函数（可通过读取debug是否打开控制检测的开关）或者通过.htaccess引入头文件形式注入。数据存储到/tmp/log下，需要时导出发送给客户支持，客户支持本地安装XHProf的GUI，本地分析
    - 每个禅道站点都需要通过index.php的方式注入

- molten

  - 以url为最小单位分析此次请求涉及到的所有sql：可获得sql语句和执行时间
  - `molten追踪php核心调用库运行时信息并且按照zipkin/optracing格式输出信息`
  - 安装
    - 最低限度：php安装扩展，配置配置项。数据同上，存储本地，需要时发给客户支持，本地导入zipkin
    - 可监听所有走php-fpm的请求

- phptrace

  - 对phpcli进行函数调用栈追踪





# 导出大小

* XHProf

  一次请求在 几十k 左右

  ![image-20221209085522905](https://lalalademaxiya01.oss-cn-beijing.aliyuncs.com/img/202212090855025.png)

* molten会将信息统计到一个文件中

  这里统计的请求数和上图xhprof差不多的，都是刷新地盘

  ![image-20221209091226111](https://lalalademaxiya01.oss-cn-beijing.aliyuncs.com/img/202212090912149.png)

​      随请求增多，逐渐变大

![image-20221209091307061](https://lalalademaxiya01.oss-cn-beijing.aliyuncs.com/img/202212090913106.png)



* 读取环境变量，控制开关
* docker-composer，可让用户选择自己看监测数据
* 通过环境变量控制开关